# add_sympathy_for_prevs_true_religion_effect
# add_sympathy_for_prevs_open_religion_effect
# flip_secret_religious_community_provinces
# flip_all_realm_secret_religious_community_provinces
# root_secret_religion_provinces_convert_effect
# reset_religion_features_effect
# apply_cosmopolian_on_start_effect
# apply_dogmatic_on_start_effect
# setup_reformed_religion_scope
# export_reformer_to_title_effect
# rebuild_god_name_effect
# convert_religion_failsafe_effect
# abdicate_all_primary_type_titles_effect

add_sympathy_for_prevs_true_religion_effect = {
	if = {
		limit = {
			PREV = { true_religion_group = christian }
			NOT = { religion_group = christian }
		}
		add_trait = sympathy_christendom
	}
	else_if = {
		limit = {
			PREV = { true_religion_group = muslim }
			NOT = { religion_group = muslim }
		}
		add_trait = sympathy_islam
	}
	else_if = {
		limit = {
			PREV = { true_religion_group = pagan_group }
			NOT = { religion_group = pagan_group }
		}
		add_trait = sympathy_pagans
	}
	else_if = {
		limit = {
			PREV = { true_religion_group = zoroastrian_group }
			NOT = { religion_group = zoroastrian_group }
		}
		add_trait = sympathy_zoroastrianism
	}
	else_if = {
		limit = {
			PREV = { true_religion_group = jewish_group }
			NOT = { religion_group = jewish_group }
		}
		add_trait = sympathy_judaism
	}
	else_if = {
		limit = {
			PREV = { true_religion_group = indian_group }
			NOT = { religion_group = indian_group }
		}
		add_trait = sympathy_indian
	}
}

add_sympathy_for_prevs_open_religion_effect = {
	if = {
		limit = {
			PREV = { religion_group = christian }
			NOT = { religion_group = christian }
		}
		add_trait = sympathy_christendom
	}
	else_if = {
		limit = {
			PREV = { religion_group = muslim }
			NOT = { religion_group = muslim }
		}
		add_trait = sympathy_islam
	}
	else_if = {
		limit = {
			PREV = { religion_group = pagan_group }
			NOT = { religion_group = pagan_group }
		}
		add_trait = sympathy_pagans
	}
	else_if = {
		limit = {
			PREV = { religion_group = zoroastrian_group }
			NOT = { religion_group = zoroastrian_group }
		}
		add_trait = sympathy_zoroastrianism
	}
	else_if = {
		limit = {
			PREV = { religion_group = jewish_group }
			NOT = { religion_group = jewish_group }
		}
		add_trait = sympathy_judaism
	}
	else_if = {
		limit = {
			PREV = { religion_group = indian_group }
			NOT = { religion_group = indian_group }
		}
		add_trait = sympathy_indian
	}
}

# TODO: Rework with persistent_event_target (religion scope). Currently unused
flip_secret_religious_community_provinces = {
	trigger_switch = {
		on_trigger = society_member_of

		secret_religious_society_catholic = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_catholic_community
						owned_by = PREV
					}

					religion = catholic
					remove_province_modifier = secret_catholic_community
				}
			}
		}
		secret_religious_society_restorationist = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_restorationist_community
						owned_by = PREV
					}

					religion = restorationist
					remove_province_modifier = secret_restorationist_community
				}
			}
		}
		secret_religious_society_orthodox = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_orthodox_community
						owned_by = PREV
					}

					religion = orthodox
					remove_province_modifier = secret_orthodox_community
				}
			}
		}
		secret_religious_society_old_believer = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_old_believer_community
						owned_by = PREV
					}

					religion = old_believer
					remove_province_modifier = secret_old_believer_community
				}
			}
		}
		secret_religious_society_yehowist = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_yehowist_community
						owned_by = PREV
					}

					religion = yehowist
					remove_province_modifier = secret_yehowist_community
				}
			}
		}
		secret_religious_society_vissarionite = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_vissarionite_community
						owned_by = PREV
					}

					religion = vissarionite
					remove_province_modifier = secret_vissarionite_community
				}
			}
		}
		secret_religious_society_vadimite = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_vadimite_community
						owned_by = PREV
					}

					religion = vadimite
					remove_province_modifier = secret_vadimite_community
				}
			}
		}
		secret_religious_society_concordanist = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_concordanist_community
						owned_by = PREV
					}

					religion = concordanist
					remove_province_modifier = secret_concordanist_community
				}
			}
		}
		secret_religious_society_adventist = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_adventist_community
						owned_by = PREV
					}

					religion = adventist
					remove_province_modifier = secret_adventist_community
				}
			}
		}
		secret_religious_society_pentecostal = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_pentecostal_community
						owned_by = PREV
					}

					religion = pentecostal
					remove_province_modifier = secret_pentecostal_community
				}
			}
		}
		secret_religious_society_baptist = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_baptist_community
						owned_by = PREV
					}

					religion = baptist
					remove_province_modifier = secret_baptist_community
				}
			}
		}
		secret_religious_society_kohhran_thianghlim = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_kohhran_thianghlim_community
						owned_by = PREV
					}

					religion = kohhran_thianghlim
					remove_province_modifier = secret_kohhran_thianghlim_community
				}
			}
		}
		secret_religious_society_fuyin = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_fuyin_community
						owned_by = PREV
					}

					religion = fuyin
					remove_province_modifier = secret_fuyin_community
				}
			}
		}
		secret_religious_society_unificationist = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_unificationist_community
						owned_by = PREV
					}

					religion = unificationist
					remove_province_modifier = secret_unificationist_community
				}
			}
		}
		secret_religious_society_tianzhu = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_tianzhu_community
						owned_by = PREV
					}

					religion = tianzhu
					remove_province_modifier = secret_tianzhu_community
				}
			}
		}
		secret_religious_society_aiguo = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_aiguo_community
						owned_by = PREV
					}

					religion = aiguo
					remove_province_modifier = secret_aiguo_community
				}
			}
		}
		secret_religious_society_nestorian = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_nestorian_community
						owned_by = PREV
					}

					religion = nestorian
					remove_province_modifier = secret_nestorian_community
				}
			}
		}
		secret_religious_society_erkeun = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_erkeun_community
						owned_by = PREV
					}

					religion = erkeun
					remove_province_modifier = secret_erkeun_community
				}
			}
		}
		secret_religious_society_eastern_lightning = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_eastern_lightning_community
						owned_by = PREV
					}

					religion = eastern_lightning
					remove_province_modifier = secret_eastern_lightning_community
				}
			}
		}
		secret_religious_society_renewalist = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_renewalist_community
						owned_by = PREV
					}

					religion = renewalist
					remove_province_modifier = secret_renewalist_community
				}
			}
		}
		secret_religious_society_salafi = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_salafi_community
						owned_by = PREV
					}

					religion = salafi
					remove_province_modifier = secret_salafi_community
				}
			}
		}
		secret_religious_society_hui = {
			ROOT = {
				any_demesne_province = {
					limit = {
						has_province_modifier = secret_hui_community
						owned_by = PREV
					}

					religion = hui
					remove_province_modifier = secret_hui_community
				}
			}
		}
	}
}

flip_all_realm_secret_religious_community_provinces = {
	trigger_switch = {
		on_trigger = society_member_of

		secret_religious_society_catholic = {
			top_liege = {
				any_realm_province = {
					limit = {
						has_province_modifier = secret_catholic_community
						held_under_PREV = yes
					}

					religion = catholic
					remove_province_modifier = secret_catholic_community
				}
			}
		}
	}
}

# TODO: Rework with persistent_event_target (religion scope)
root_secret_religion_provinces_convert_effect = {
	ROOT = {
		trigger_switch = {
			on_trigger = society_member_of

			secret_religious_society_catholic = {
				PREV = {
					any_demesne_province = {
						limit = {
							has_province_modifier = secret_catholic_community
							owned_by = PREV
						}

						religion = catholic
						remove_province_modifier = secret_catholic_community
					}
				}
			}
		}
	}
}

# Referenced by Alternate Start religion feature generation
reset_religion_features_effect = {
	set_peace_piety_gain = 0
	set_pacifist = no
	set_convert_other_groups = 2
	set_convert_same_group = 2
	set_peace_prestige_loss = no
	set_ai_aggression = 1
	set_unit_modifier = { }
	set_unit_home_modifier = { }
	set_hard_to_convert = no
	set_raised_vassal_opinion_loss = yes
	set_piety_loss_for_attacking_same_religion = no
	set_max_wives = 1
	set_max_consorts = 0
	set_feminist = no
	set_heir_designation = no
	set_short_reign_opinion_year_mult = -1000
	set_jizya_tax = no
	set_can_retire_to_monastery = no
	set_can_excommunicate = no
	set_can_grant_divorce = no
	set_can_grant_invasion_cb = no
	set_can_grant_claim = no
	set_can_call_crusade = no
	set_pc_marriage = no
	set_bs_marriage = no
	set_psc_marriage = yes
	set_cousin_marriage = yes
	set_seafaring = no
	set_allow_looting = no
	set_allow_rivermovement = no
	set_autocephaly = no
	set_pentarchy = no
	set_divine_blood = no
	set_uses_decadence = no
	set_can_have_antipopes = no
	set_priests_can_marry = no
	set_priests_can_inherit = yes
	set_ignores_defensive_attrition = no
	set_defensive_attrition = no
	clear_intermarry = no
	set_character_modifier = { }
	clear_intermarry = yes
	set_allows_matrilineal_marriage = yes
}

apply_cosmopolian_on_start_effect = {
	religion_authority = {
		name = cosmopolitan_religion
		years = 1000
	}

	any_playable_ruler = {
		limit = {
			distance_from_realm = {
				who = ROOT
				value < 200
			}
		}

		add_intermarry = ROOT
		ROOT = { add_intermarry = PREV }
	}

	any_neighbor_independent_ruler = {
		add_intermarry = ROOT
		ROOT = { add_intermarry = PREV }
	}
}

apply_dogmatic_on_start_effect = {
	religion_authority = {
		name = dogmatic_religion
		years = 1000
	}

	remove_intermarry = pagan_group
	remove_intermarry = zoroastrian_group
	remove_intermarry = christian
	remove_intermarry = muslim
	remove_intermarry = indian_group
	remove_intermarry = jewish_group
	remove_intermarry = eastern
	remove_intermarry = buddhist_group
	remove_intermarry = japonic
	remove_intermarry = oldworld
	remove_intermarry = nautical
	remove_intermarry = latter_day_saints
}

# # Fires on_startup
# setup_reformed_religion_scope

# export_reformer_to_title_effect

# rebuild_god_name_effect

# abdicate_all_primary_type_titles_effect