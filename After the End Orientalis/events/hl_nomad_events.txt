namespace = HL

##########################
# Nomad Pillaging Events #
##########################

#Bugged in Total Conversion Mods

######################################
# Nomad Cultural Preservation Events #
######################################

character_event = {
	id = HL.4994
	desc = EVTDESC_HL_4994
	picture = GFX_evt_horsemanship
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
		event_target:new_nomad = {
			opinion = {
				modifier = opinion_loyal_servant
				who = ROOT
				years = 10
			}
		}
	}

}

character_event = {
	id = HL.4995
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		any_realm_province = {
			any_neighbor_province = {
				holder_scope = {
					top_liege = {
						culture = ROOT
						is_nomadic = yes
						tier = EMPEROR
						NOT = { character = ROOT }
					}
				}
			}
		}
	}
	
	immediate = {
		any_realm_province = {
			any_neighbor_province = {
				holder_scope = {
					top_liege = {
						if = {
							limit = {
								culture = ROOT
								is_nomadic = yes
								tier = EMPEROR
								NOT = { character = ROOT }
							}
							save_event_target_as = new_nomad_liege
						}
					}
				}
			}
		}
		ROOT = {
			set_defacto_liege = event_target:new_nomad_liege
		}
		event_target:new_nomad_liege = { character_event = { id = HL.4994 } }
	}

}

character_event = {
	id = HL.4996
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		ROOT = { is_nomadic = yes }
		FROM = {
			tier = COUNT
			location = {
				has_province_modifier = nomad_agitation
			}
		}
	}
	
	immediate = {
		FROM = {
			location = {
				remove_province_modifier = nomad_agitation
			}
		}
	}

}

character_event = {
	id = HL.4997
	title = NOMADSLEAVINGTITLE
	desc = EVTDESC_HL_4997
	picture = GFX_evt_horsemanship
	
	is_triggered_only = yes
	
	option = {
		name = CURSES
	}

}

character_event = {
	id = HL.4998
	hide_window = yes
	
	is_triggered_only = yes
	only_playable = yes
	only_independent = yes
	
	trigger = {
		higher_tier_than = BARON
		NOT = { is_nomadic = yes }
		any_realm_province = {
			NOT = { has_province_modifier = nomad_agitation }
		}
		any_realm_province = {
			has_province_modifier = nomad_agitation
			ROOT = {
				capital_scope = {
					NOT = { province = PREVPREV }
				}
			}
		}
	}
	
	immediate = {
		clr_character_flag = found_nomad_separatist
		random_realm_province = {
			limit = {
				has_province_modifier = nomad_agitation
				NOR = {
					any_province_holding = { holding_type = castle }
					#any_province_holding = { holding_type = temple }
					any_province_holding = { holding_type = city }
					has_settlement_construction = yes
					AND = {
						ROOT = { is_tribal = yes }
						any_province_holding = {
							holding_type = tribal
							num_of_buildings = 2
						}
					}
					ROOT = {
						capital_scope = {
							province = PREVPREV
						}
					}
				}
			}
			ROOT = { set_character_flag = found_nomad_separatist }
			remove_province_modifier = nomad_agitation
			save_event_target_as = new_nomad_province
			county = {
				create_random_soldier = {
					random_traits = yes
					dynasty = random
					religion = PREV
					culture = PREV
					female = no
					age = 25
				}
				new_character = {
					prestige = 800
					wealth = 250
					piety = 200
					grant_title = { target = PREV type = revolt }
					set_defacto_liege = THIS
					set_government_type = nomadic_government
					save_event_target_as = new_nomad
				}
				create_random_soldier = {
					random_traits = yes
					dynasty = NONE
					religion = PREV
					culture = PREV
					female = yes
					age = 23
				}
				new_character = {
					add_spouse = event_target:new_nomad
					save_event_target_as = new_nomad_wife
				}
				create_character = {
					age = 6
					religion = PREV
					culture = PREV
					female = no
				}
				new_character = {
					dynasty = event_target:new_nomad
					set_father = event_target:new_nomad
					set_mother = event_target:new_nomad_wife
				}
				create_character = {
					age = 5
					religion = PREV
					culture = PREV
					female = no
				}
				new_character = {
					dynasty = event_target:new_nomad
					set_father = event_target:new_nomad
					set_mother = event_target:new_nomad_wife
				}
				create_character = {
					age = 4
					religion = PREV
					culture = PREV
					female = yes
				}
				new_character = {
					dynasty = event_target:new_nomad
					set_father = event_target:new_nomad
					set_mother = event_target:new_nomad_wife
				}
				event_target:new_nomad = {
					population = 1000
					manpower = 250
					spawn_unit = {
						province = PREV
						troops = {
							horse_archers = { 225 225 }
							light_cavalry = { 450 450 }
							knights = { 75 75 }
						}
					}
				}
			}
			any_province_holding = {
				limit = {
					holding_type = tribal
				}
				destroy_settlement = THIS
			}
			ROOT = { character_event = { id = HL.4997 } }
		}
		if = {
			limit = {
				has_character_flag = found_nomad_separatist
			}
			any_realm_province = {
				limit = {
					culture = event_target:new_nomad
					has_province_modifier = nomad_agitation
					NOR = {
						any_province_holding = { holding_type = castle }
						#any_province_holding = { holding_type = temple }
						any_province_holding = { holding_type = city }
						has_settlement_construction = yes
						AND = {
							ROOT = { is_tribal = yes }
							any_province_holding = {
								holding_type = tribal
								num_of_buildings = 2
							}
						}
						ROOT = {
							capital_scope = {
								province = PREVPREV
							}
						}
					}
				}
				remove_province_modifier = nomad_agitation
				county = {
					grant_title = { target = event_target:new_nomad type = revolt }
					event_target:new_nomad = {
						population = 375
						manpower = 100
						spawn_unit = {
							province = PREV
							troops = {
								horse_archers = { 75 75 }
								light_cavalry = { 150 150 }
								knights = { 25 25 }
							}
						}
					}
				}
				any_province_holding = {
					limit = {
						holding_type = tribal
					}
					destroy_settlement = THIS
				}
			}
			ROOT = { character_event = { id = HL.4998 } }
			event_target:new_nomad = { character_event = { id = HL.4995 } }
		}
	}
}

character_event = {
	id = HL.4999
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { ROOT = { is_nomadic = yes } }
		#NAND = {
		#	FROMFROM = { culture = ROOT }
		#	FROMFROM = { is_nomadic = yes }
		#	ROOT = { is_nomadic = yes }
		#}
		FROM = {
			tier = COUNT
			location = {
				NOR = {
					has_province_modifier = incredibly_poor
					any_province_holding = { holding_type = tribal }
					any_province_holding = { holding_type = castle }
					#any_province_holding = { holding_type = temple }
					any_province_holding = { holding_type = city }
					has_settlement_construction = yes
				}
			}
		}
	}
	
	immediate = {
		if = { # Raiding Adventurers of the same culture become Clan Chiefs
			limit = {
				ROOT = {
					culture = FROMFROM
					OR = {
						AND = {
							is_ruler = yes
							is_landed = no	
							NOT = { is_offmap_governor = yes } #offmap governors do not become nomads
						}
						has_character_modifier = raiding_adventurer_nomad_timer
					}
				}
				FROMFROM = { is_nomadic = yes }
			}
			FROM = {
				location = {
					build_holding = {
					   type = tribal
					   holder = ROOT
					}
				}
			}
			ROOT = {
				set_government_type = nomadic_government
				add_character_modifier = {
					modifier = raiding_adventurer_nomad_timer
					days = 10
					hidden = yes
				}
			}
			FROM = {
				location = {
					any_province_holding = {
						limit = {
							holding_type = tribal
						}
						destroy_settlement = THIS
					}
				}
			}
			break = yes
		}
		if = { # Raiding Adventurers of the wrong culture become Tribal Vassals
			limit = {
				ROOT = {
					NOT = { culture = FROMFROM }
					OR = {
						AND = {
							is_ruler = yes
							is_landed = no	
							NOT = { is_offmap_governor = yes } #offmap governors do not become tribal
						}
						has_character_modifier = raiding_adventurer_tribal_timer
					}
				}
				FROMFROM = { is_nomadic = yes }
			}
			FROM = {
				location = {
					build_holding = {
					   type = tribal
					   holder = ROOT
					}
					if = {
						limit = {
							ROOT = { NOT = { culture_group = altaic } }
						}
						religion = FROMFROM
						culture = FROMFROM
					}
					if = {
						limit = {
							ROOT = { culture_group = altaic }
						}
						religion = ROOT
						culture = ROOT
					}
				}
			}
			ROOT = { 
				set_government_type = tribal_government
				add_character_modifier = {
					modifier = raiding_adventurer_tribal_timer
					days = 10
					hidden = yes
				}
			}
			break = yes
		}
		FROM = {
			location = {
				build_holding = {
				   type = tribal
				   holder = ROOT
				}
				religion = FROMFROM
				culture = FROMFROM
				add_province_modifier = {
					name = nomad_agitation
					years = 100
				}
			}
		}
	}
}